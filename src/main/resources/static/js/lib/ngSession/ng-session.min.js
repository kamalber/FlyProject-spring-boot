!function(n){"use strict";function e(n,e,r){function s(e,r){n.session.user=r.data,e.resolve(r)}function t(n){return g(null,n)}function i(e,r){n.session.user=null,e.resolve(r)}function l(s,i){var u=r.defer();return n.session.user=null,e.post(o.signInUrl,s,i).then(t.bind(null,u)).catch(u.reject),u.promise}function c(n,s){var t=r.defer();return e.post(o.signOutUrl,n,s).then(i.bind(null,t)).catch(t.reject),t.promise}function a(n,s,t){return t||(t=r.defer()),e.put(o.updateUrl,n,s).then(g.bind(null,s,t)).catch(t.reject),t.promise}function g(n,t){return t||(t=r.defer()),e.get(o.updateUrl,n).then(s.bind(null,t)).catch(t.reject),t.promise}function f(e){var r=n.session;return r?e&&r.user?r.user[e]:r.user:null}function d(n,e){var r=f("roles"),s=0;if(!r||!r.length)return!1;u.isString(r)&&(r=[r]),u.isString(n)&&(n=[n]);for(var t=0,i=n.length;t<i;t++)r.indexOf(n[t])>-1&&s++;return e?s===n.length:!!s}function p(e,r){n.session[e]=r}function U(e){return n.session[e]}function v(e){delete n.session[e]}n.session={};var h={hasRole:d,signOut:c,signIn:l,reload:a,update:g,user:f,get:U,set:p,del:v};return h}function r(n){return l?l:(l=!0,n.update())}function s(n){for(var e in n.routes){var r=n.routes[e];u.isObject(r.resolve)||(r.resolve={}),r.resolve._session=c}}function t(n){u.isString(n.updateUrl)&&(o.updateUrl=n.updateUrl),u.isString(n.signInUrl)&&(o.signInUrl=n.signInUrl),u.isString(n.signOutUrl)&&(o.signOutUrl=n.signOutUrl)}function i(){return a}var u=n.angular,o={signOutUrl:"/api/users/sign-out",signInUrl:"/api/users/sign-in",updateUrl:"/acount/session"},l=!1,c=["ngSession",r],a={configure:t,$get:["$rootScope","$http","$q",e]};u.module("ngSession",[]).provider("ngSession",i).run(["$route",s])}(window);
// #
// sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXNlc3Npb24uanMiXSwibmFtZXMiOlsid2luZG93IiwibmdTZXNzaW9uU2VydmljZUZuIiwiJHJvb3RTY29wZSIsIiRodHRwIiwiJHEiLCJvblNlc3Npb25VcGRhdGVTdWNjZXNzIiwiZGVmZXJyZWQiLCJyZXMiLCJzZXNzaW9uIiwidXNlciIsImRhdGEiLCJyZXNvbHZlIiwib25TaW5nSW5TdWNjZXNzIiwidXBkYXRlIiwib25TaW5nT3V0U3VjY2VzcyIsInNpZ25JbiIsImNvbmZpZyIsImRlZmVyIiwicG9zdCIsIkNPTkZJRyIsInNpZ25JblVybCIsInRoZW4iLCJiaW5kIiwiY2F0Y2giLCJyZWplY3QiLCJwcm9taXNlIiwic2lnbk91dCIsInNpZ25PdXRVcmwiLCJyZWxvYWQiLCJwdXQiLCJ1cGRhdGVVcmwiLCJnZXQiLCJwcm9wIiwiaGFzUm9sZSIsInJvbGVzIiwiYWxsIiwiYWN0dWFsIiwibWF0Y2hlcyIsImxlbmd0aCIsIm5nIiwiaXNTdHJpbmciLCJpIiwibCIsImluZGV4T2YiLCJzZXQiLCJ2YWx1ZSIsImRlbCIsIm5nU2Vzc2lvblNlcnZpY2VEZWYiLCJzZXNzaW9uUmVzb2x2ZUZuIiwiJHNlc3Npb24iLCJyZXNvbHZlZCIsIm5nU2Vzc2lvblJ1bkZuIiwiJHJvdXRlIiwicGF0aCIsInJvdXRlcyIsInJvdXRlIiwiaXNPYmplY3QiLCJfc2Vzc2lvbiIsInNlc3Npb25SZXNvbHZlRGVmIiwiY29uZmlndXJlIiwibmdTZXNzaW9uUHJvdmlkZXJGbiIsIm5nU2Vzc2lvblByb3ZpZGVyRGVmIiwiYW5ndWxhciIsIiRnZXQiLCJtb2R1bGUiLCJwcm92aWRlciIsInJ1biJdLCJtYXBwaW5ncyI6IkNBU0MsU0FBVUEsR0FDVCxZQWdCQSxTQUFTQyxHQUFtQkMsRUFBWUMsRUFBT0MsR0FhN0MsUUFBU0MsR0FBdUJDLEVBQVVDLEdBQ3hDTCxFQUFXTSxRQUFRQyxLQUFPRixFQUFJRyxLQUU5QkosRUFBU0ssUUFBUUosR0FRbkIsUUFBU0ssR0FBZ0JO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QU9XLGNBQ3JCUixFQUFPUSxXQUFhWCxFQUFPVyxZQXdCL0IsUUFBU2lDLEtBQ1AsTUFBT0MsR0FuWVQsR0FBSXRCLEdBQUt2QyxFQUFPOEQsUUFHWjNDLEdBQ0ZRLFdBQVksc0JBQ1pQLFVBQVcscUJBQ1hVLFVBQVcsZ0JBNlJUb0IsR0FBVyxFQWtCWFEsR0FDRixZQUVBVixHQTJERWEsR0FDRkYsVUFBV0EsRUFFWEksTUFDRSxhQUFjLFFBQVMsS0FFdkI5RCxHQWNKc0MsR0FBR3lCLE9BQU8sZ0JBR1RDLFNBQVMsWUFBYUwsR0FHdEJNLEtBQUssU0FBVWYsS0FFaEJuRCIsImZpbGUiOiJuZy1zZXNzaW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBuZ1Nlc3Npb25cbiAqXG4gKiBAZGVzY3JpcHRpb24gU2Vzc2lvbiBoYW5kbGVyIG1vZHVsZSBmb3IgQW5ndWxhckpTLlxuICogQG1vZHVsZSBuZ1Nlc3Npb25cbiAqIEBhdXRob3IgRmluYWwgRGV2ZWxvcG1lbnQgU3R1ZGlvXG4gKiBAbGljZW5zZSBNSVRcbiAqL1xuXG4oZnVuY3Rpb24gKHdpbmRvdykge1xuICAndXNlIHN0cmljdCc7XG5cbiAgdmFyIG5nID0gd2luZG93LmFuZ3VsYXI7XG5cbiAgLyogRGVmYXVsdCBjb25maWd1cmF0aW9uICovXG4gIHZhciBDT05GSUcgPSB7XG4gICAgc2lnbk91dFVybDogJy9hcGkvdXNlcnMvc2lnbi1vdXQnLFxuICAgIHNpZ25JblVybDogJy9hcGkvdXNlcnMvc2lnbi1pbicsXG4gICAgdXBkYXRlVXJsOiAnL2FwaS9zZXNzaW9uJ1xuICB9O1xuXG4gIC8qKlxuICAgKiBuZ1Nlc3Npb24gc2VydmljZSBmdW5jdGlvbi5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGZ1bmN0aW9uIG5nU2Vzc2lvblNlcnZpY2VGbigkcm9vdFNjb3BlLCAkaHR0cCwgJHEpIHtcbiAgICAkcm9vdFNjb3BlLnNlc3Npb24gPSB7fTtcblxuICAgIC8qKlxuICAgICAqIEBtb2R1bGUgbmdTZXNzaW9uXG4gICAgICogQGRlc2NyaXB0aW9uIG5nU2Vzc2lvbiBTZXJ2aWNlXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBTZXNzaW9uIHVwZGF0ZSBzdWNjZXNzZnVsLlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBvblNlc3Npb25VcGRhdGVTdWNjZXNzKGRlZmVycmVkLCByZXMpIHtcbiAgICAgICRyb290U2NvcGUuc2Vzc2lvbi51c2VyID0gcmVzLmRhdGE7XG5cbiAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPbiBTaWduIEluIHN1Y2Nlc3MuXG4gICAgICpcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIG9uU2luZ0luU3VjY2VzcyhkZWZlcnJlZCkge1xuICAgICAgcmV0dXJuIHVwZGF0ZShudWxsLCBkZWZlcnJlZCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogT24gU2lnbiBPdXQgc3VjY2Vzcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgZnVuY3Rpb24gb25TaW5nT3V0U3VjY2VzcyhkZWZlcnJlZCwgcmVzKSB7XG4gICAgICAkcm9vdFNjb3BlLnNlc3Npb24udXNlciA9IG51bGw7XG5cbiAgICAgIGRlZmVycmVkLnJlc29sdmUocmVzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBTaWducyBhIHVzZXIgaW4uXG4gICAgICpcbiAgICAgKiBJdCB3aWxsIHBlcmZvcm0gYSBgUE9TVGAgdG8gdGhlIGBjb25maWcuc2lnbk91dFVybGAgcGF0aCBhbmQgcGVyZm9ybSBhblxuICAgICAqIGB1cGRhdGVgIGlmIHN1Y2Nlc3NmdWwuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gZGF0YSBUaGUgZGF0YSB0byBzZW5kIGZvciBzaWduIGluLlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWcgT3B0aW9uYWwgQW5ndWxhckpTIEhUVFAgcmVxdWVzdCBjb25maWd1cmF0aW9uLlxuICAgICAqXG4gICAgICogQHJldHVybnMge1Byb21pc2V9IEEgcHJvbWlzZSByZXNvbHZpbmcgdGhlIHJlcXVlc3QncyBgcmVzYCBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIG5nU2Vzc2lvbi5zaWduSW4oJHNjb3BlLmRhdGEpXG4gICAgICogICAudGhlbihmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKiAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzaWduSW4oZGF0YSwgY29uZmlnKSB7XG4gICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAvKiBSZW1vdmUgcHJldmlvdXMgdXNlciBvYmplY3QgKi9cbiAgICAgICRyb290U2NvcGUuc2Vzc2lvbi51c2VyID0gbnVsbDtcblxuICAgICAgJGh0dHAucG9zdChDT05GSUcuc2lnbkluVXJsLCBkYXRhLCBjb25maWcpXG4gICAgICAgIC50aGVuKG9uU2luZ0luU3VjY2Vzcy5iaW5kKG51bGwsIGRlZmVycmVkKSlcbiAgICAgICAgLmNhdGNoKGRlZmVycmVkLnJlamVjdCk7XG5cbiAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNpZ25zIGEgdXNlciBvdXQuXG4gICAgICpcbiAgICAgKiBJdCB3aWxsIHBlcmZvcm0gYSBQT1NUIHRvIHRoZSBgY29uZmlnLnNpZ25PdXRVcmxgIHBhdGggYW5kIGRlbGV0ZSB0aGVcbiAgICAgKiB1c2VyIG9iamVjdCBvbiBzdWNjZXNzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGRhdGEgVGhlIG9wdGlvbmFsIGRhdGEgdG8gc2VuZCBmb3Igc2lnbiBvdXQuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBPcHRpb25hbCBBbmd1bGFySlMgSFRUUCByZXF1ZXN0IGNvbmZpZ3VyYXRpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0gQSBwcm9taXNlIHJlc29sdmluZyB0aGUgcmVxdWVzdCdzIGByZXNgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLnNpZ25PdXQoJHNjb3BlLmRhdGEpXG4gICAgICogICAudGhlbihmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKiAgIC5jYXRjaChmdW5jdGlvbiAocmVzKSB7fSlcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBzaWduT3V0KGRhdGEsIGNvbmZpZykge1xuICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgJGh0dHAucG9zdChDT05GSUcuc2lnbk91dFVybCwgZGF0YSwgY29uZmlnKVxuICAgICAgICAudGhlbihvblNpbmdPdXRTdWNjZXNzLmJpbmQobnVsbCwgZGVmZXJyZWQpKVxuICAgICAgICAuY2F0Y2goZGVmZXJyZWQucmVqZWN0KTtcblxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVsb2FkcyB0aGUgc2Vzc2lvbiB1c2VyIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEl0IHdpbGwgcGVyZm9ybSBhIFBVVCB0byB0aGUgYGNvbmZpZy51cGRhdGVVcmxgIHBhdGggYW5kIHRoZW4gYVxuICAgICAqIGNvbnNlY3VlbnQgc2Vzc2lvbiBgdXBkYXRlYC5cbiAgICAgKlxuICAgICAqIFRoZSBzZXJ2ZXIgc2hvdWxkIGhhbmRsZSB0aGUgT1V0IHJlcXVlc3QgYXMgYSByZWxvYWQgcmVxdWVzdCBhbmQgZmV0Y2hcbiAgICAgKiB1cGRhdGVkIHNlc3Npb24gZGF0YS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIFRoZSBvcHRpb25hbCBkYXRhIHRvIHNlbmQgZm9yIHRoZSByZWxvYWQuXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBPcHRpb25hbCBBbmd1bGFySlMgSFRUUCByZXF1ZXN0IGNvbmZpZ3VyYXRpb24uXG4gICAgICogQHBhcmFtIHtQcm9taXNlfSBkZWZlcnJlZCBPcHRpb25hbCBkZWZlcnJlZCBwcm9taXNlIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfSBBIHByb21pc2UgcmVzb2x2aW5nIHRoZSByZXF1ZXN0J3MgYHJlc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBuZ1Nlc3Npb24ucmVsb2FkKCRzY29wZS5kYXRhKVxuICAgICAqICAgLnRoZW4oZnVuY3Rpb24gKHJlcykge30pXG4gICAgICogICAuY2F0Y2goZnVuY3Rpb24gKHJlcykge30pXG4gICAgICovXG4gICAgZnVuY3Rpb24gcmVsb2FkKGRhdGEsIGNvbmZpZywgZGVmZXJyZWQpIHtcbiAgICAgIGlmICghZGVmZXJyZWQpIHtcbiAgICAgICAgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgfVxuXG4gICAgICAvKiBSZWxvYWRzIGN1cnJlbnQgc2Vzc2lvbiAqL1xuICAgICAgJGh0dHAucHV0KENPTkZJRy51cGRhdGVVcmwsIGRhdGEsIGNvbmZpZylcbiAgICAgICAgLnRoZW4odXBkYXRlLmJpbmQobnVsbCwgY29uZmlnLCBkZWZlcnJlZCkpXG4gICAgICAgIC5jYXRjaChkZWZlcnJlZC5yZWplY3QpO1xuXG4gICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBzZXNzaW9uIHVzZXIgb2JqZWN0LlxuICAgICAqXG4gICAgICogSXQgd2lsbCBwZXJmb3JtIGEgR0VUIHRvIHRoZSBgY29uZmlnLnVwZGF0ZVVybGAgcGF0aCBhbmQgc2V0IHRoZVxuICAgICAqIHNlc3Npb24ncyB1c2VyIG9iamVjdCBvbiBzdWNjZXNzIHdpdGggdGhlIHJlcXVlc3QncyBgcmVzLmRhdGFgLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBPcHRpb25hbCBBbmd1bGFySlMgSFRUUCByZXF1ZXN0IGNvbmZpZ3VyYXRpb24uXG4gICAgICogQHBhcmFtIHtQcm9taXNlfSBkZWZlcnJlZCBPcHRpb25hbCBkZWZlcnJlZCBwcm9taXNlIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlfSBBIHByb21pc2UgcmVzb2x2aW5nIHRoZSByZXF1ZXN0J3MgYHJlc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBuZ1Nlc3Npb24udXBkYXRlKClcbiAgICAgKiAgIC50aGVuKGZ1bmN0aW9uIChyZXMpIHt9KVxuICAgICAqICAgLmNhdGNoKGZ1bmN0aW9uIChyZXMpIHt9KVxuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVwZGF0ZShjb25maWcsIGRlZmVycmVkKSB7XG4gICAgICBpZiAoIWRlZmVycmVkKSB7XG4gICAgICAgIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgIH1cblxuICAgICAgLyogUmV0cmlldmUgY3VycmVudCBzZXNzaW9uICovXG4gICAgICAkaHR0cC5nZXQoQ09ORklHLnVwZGF0ZVVybCwgY29uZmlnKVxuICAgICAgICAudGhlbihvblNlc3Npb25VcGRhdGVTdWNjZXNzLmJpbmQobnVsbCwgZGVmZXJyZWQpKVxuICAgICAgICAuY2F0Y2goZGVmZXJyZWQucmVqZWN0KTtcblxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIGEgdXNlciBkYXRhIHZhbHVlIGJ5IHByb3BlcnR5IG5hbWUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBUaGUgcHJvcGVydHkgbmFtZSB0byByZXRyaWV2ZS5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtNaXhlZH0gVGhlIHByb3BlcnR5J3MgdmFsdWUgb3IgdGhlIHVzZXIgb2JqZWN0IGlmIG5vXG4gICAgICogcHJvcGVydHkgbmFtZSBpcyBwcm92aWRlZC5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlIG5nU2Vzc2lvbi51c2VyKCduYW1lJyk7IC8vID0+ICdKb2huIFNtaXRoJ1xuICAgICAqL1xuICAgIGZ1bmN0aW9uIHVzZXIocHJvcCkge1xuICAgICAgdmFyIHNlc3Npb24gPSAkcm9vdFNjb3BlLnNlc3Npb247XG5cbiAgICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgaWYgKHByb3AgJiYgc2Vzc2lvbi51c2VyKSB7XG4gICAgICAgIHJldHVybiBzZXNzaW9uLnVzZXJbcHJvcF07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBzZXNzaW9uLnVzZXI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIHRoZSBjdXJyZW50IHVzZXIgaGFzIGFueSBvciBhbGwgb2YgdGhlIHByb3ZpZGVkIHJvbGVzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHsoU3RyaW5nfFN0cmluZ1tdKX0gcm9sZXMgVGhlIHJlcXVpcmVkIHJvbGVzLlxuICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gYWxsIElmIGFsbCB0aGUgcHJvdmlkZWQgcm9sZXMgYXJlIHJlcXVpcmVkLlxuICAgICAqXG4gICAgICogQHJldHVybiB7Qm9vbGVhbn1cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLmhhc1JvbGVzKCdST0xFLkFETUlOJyk7IC8vID0+IGZhbHNlXG4gICAgICogbmdTZXNzaW9uLmhhc1JvbGVzKCdST0xFLlVTRVInKTsgLy8gPT4gdHJ1ZVxuICAgICAqIG5nU2Vzc2lvbi5oYXNSb2xlcyhbJ1JPTEUuQURNSU4nLCAnUk9MRS5VU0VSJ10pOyAvLyA9PiB0cnVlXG4gICAgICogbmdTZXNzaW9uLmhhc1JvbGVzKFsnUk9MRS5BRE1JTicsICdST0xFLlVTRVInXSwgdHJ1ZSk7IC8vID0+IGZhbHNlXG4gICAgICovXG4gICAgZnVuY3Rpb24gaGFzUm9sZShyb2xlcywgYWxsKSB7XG4gICAgICB2YXIgYWN0dWFsID0gdXNlcigncm9sZXMnKTtcbiAgICAgIHZhciBtYXRjaGVzID0gMDtcblxuICAgICAgaWYgKCFhY3R1YWwgfHwgIWFjdHVhbC5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZiAobmcuaXNTdHJpbmcoYWN0dWFsKSkge1xuICAgICAgICBhY3R1YWwgPSBbYWN0dWFsXTtcbiAgICAgIH1cblxuICAgICAgaWYgKG5nLmlzU3RyaW5nKHJvbGVzKSkge1xuICAgICAgICByb2xlcyA9IFtyb2xlc107XG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gcm9sZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgIGlmIChhY3R1YWwuaW5kZXhPZihyb2xlc1tpXSkgPiAtMSkge1xuICAgICAgICAgIG1hdGNoZXMrKztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoYWxsKSB7XG4gICAgICAgIHJldHVybiBtYXRjaGVzID09PSByb2xlcy5sZW5ndGg7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAhIW1hdGNoZXM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyBhIHZhbHVlIGluIHRoZSBzZXNzaW9uIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBwcm9wIFRoZSBwcm9wZXJ0eSBuYW1lIHRvIHNldC5cbiAgICAgKiBAcGFyYW0ge01peGVkfSBUaGUgcHJvcGVydHkgdmFsdWUgdG8gc2V0LlxuICAgICAqXG4gICAgICogQGV4YW1wbGUgbmdTZXNzaW9uLnNldCgndGVzdCcsICdUZXN0IFZhbHVlJyk7XG4gICAgICovXG4gICAgZnVuY3Rpb24gc2V0KHByb3AsIHZhbHVlKSB7XG4gICAgICAkcm9vdFNjb3BlLnNlc3Npb25bcHJvcF0gPSB2YWx1ZTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPYnRhaW5zIGEgdmFsdWUgZnJvbSB0aGUgc2Vzc2lvbiBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBUaGUgcHJvcGVydHkgbmFtZSB0byBvYnRhaW4uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7TWl4ZWR9IFRoZSBwcm9wZXJ0eSdzIHZhbHVlLlxuICAgICAqXG4gICAgICogQGV4YW1wbGUgbmdTZXNzaW9uLmdldCgndGVzdCcpOyAvLyA9PiAnVGVzdCBWYWx1ZSdcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXQocHJvcCkge1xuICAgICAgcmV0dXJuICRyb290U2NvcGUuc2Vzc2lvbltwcm9wXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIGEgcHJvcGVydHkgZnJvbSB0aGUgc2Vzc2lvbiBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBUaGUgcHJvcGVydHkgbmFtZS5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogbmdTZXNzaW9uLmRlbCgndGVzdCcpO1xuICAgICAqIG5nU2Vzc2lvbi5nZXQoJ3Rlc3QnKTsgLy8gPT4gbnVsbFxuICAgICAqL1xuICAgIGZ1bmN0aW9uIGRlbChwcm9wKSB7XG4gICAgICBkZWxldGUgJHJvb3RTY29wZS5zZXNzaW9uW3Byb3BdO1xuICAgIH1cblxuICAgIC8qIFNlc3Npb24gc2VydmljZSBkZWZpbml0aW9uICovXG4gICAgdmFyIG5nU2Vzc2lvblNlcnZpY2VEZWYgPSB7XG4gICAgICBoYXNSb2xlOiBoYXNSb2xlLFxuICAgICAgc2lnbk91dDogc2lnbk91dCxcbiAgICAgIHNpZ25Jbjogc2lnbkluLFxuICAgICAgcmVsb2FkOiByZWxvYWQsXG4gICAgICB1cGRhdGU6IHVwZGF0ZSxcbiAgICAgIHVzZXI6IHVzZXIsXG4gICAgICBnZXQ6IGdldCxcbiAgICAgIHNldDogc2V0LFxuICAgICAgZGVsOiBkZWxcbiAgICB9O1xuXG4gICAgcmV0dXJuIG5nU2Vzc2lvblNlcnZpY2VEZWY7XG4gIH1cblxuICB2YXIgcmVzb2x2ZWQgPSBmYWxzZTtcblxuICAvKipcbiAgICogU2Vzc2lvbiByZXNvbHZlIGNhbGxiYWNrIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgZnVuY3Rpb24gc2Vzc2lvblJlc29sdmVGbigkc2Vzc2lvbikge1xuICAgIGlmIChyZXNvbHZlZCkge1xuICAgICAgcmV0dXJuIHJlc29sdmVkO1xuICAgIH1cblxuICAgIHJlc29sdmVkID0gdHJ1ZTtcblxuICAgIHJldHVybiAkc2Vzc2lvbi51cGRhdGUoKTtcbiAgfVxuXG4gIC8qIFNlc3Npb24gcmVzb2x2ZSBkZWZpbml0aW9uICovXG4gIHZhciBzZXNzaW9uUmVzb2x2ZURlZiA9IFtcbiAgICAnbmdTZXNzaW9uJyxcblxuICAgIHNlc3Npb25SZXNvbHZlRm5cbiAgXTtcblxuICAvKipcbiAgICogbmdTZXNzaW9uIHJ1biBmdW5jdGlvbi5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGZ1bmN0aW9uIG5nU2Vzc2lvblJ1bkZuKCRyb3V0ZSkge1xuICAgIGZvciAodmFyIHBhdGggaW4gJHJvdXRlLnJvdXRlcykge1xuICAgICAgdmFyIHJvdXRlID0gJHJvdXRlLnJvdXRlc1twYXRoXTtcblxuICAgICAgaWYgKCFuZy5pc09iamVjdChyb3V0ZS5yZXNvbHZlKSkge1xuICAgICAgICByb3V0ZS5yZXNvbHZlID0ge307XG4gICAgICB9XG5cbiAgICAgIHJvdXRlLnJlc29sdmUuX3Nlc3Npb24gPSBzZXNzaW9uUmVzb2x2ZURlZjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQG1vZHVsZSBuZ1Nlc3Npb25Qcm92aWRlclxuICAgKiBAZGVzY3JpcHRpb24gbmdTZXNzaW9uIFByb3ZpZGVyXG4gICAqL1xuXG4gIC8qKlxuICAgKiBDb25maWd1cmF0aW9uIG1ldGhvZC5cbiAgICpcbiAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZyBUaGUgY29uZmlndXJhdGlvbiBvYmplY3QuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIG5nU2Vzc2lvblByb3ZpZGVyLmNvbmZpZ3VyZSh7XG4gICAqICAgc2lnbk91dFVybDogJy9hcGkvdXNlcnMvc2lnbi1vdXQnLFxuICAgKiAgIHNpZ25JblVybDogJy9hcGkvdXNlcnMvc2lnbi1pbicsXG4gICAqICAgdXBkYXRlVXJsOiAnL2FwaS9zZXNzaW9uJ1xuICAgKiB9KTtcbiAgICovXG4gIGZ1bmN0aW9uIGNvbmZpZ3VyZShjb25maWcpIHtcbiAgICAvKiBTZXRzIHNlc3Npb24gdXBkYXRlIEdFVCBVUkwgKi9cbiAgICBpZiAobmcuaXNTdHJpbmcoY29uZmlnLnVwZGF0ZVVybCkpIHtcbiAgICAgIENPTkZJRy51cGRhdGVVcmwgPSBjb25maWcudXBkYXRlVXJsO1xuICAgIH1cblxuICAgIC8qIFNldHMgc2lnbiBpbiBQT1NUIFVSTCAqL1xuICAgIGlmIChuZy5pc1N0cmluZyhjb25maWcuc2lnbkluVXJsKSkge1xuICAgICAgQ09ORklHLnNpZ25JblVybCA9IGNvbmZpZy5zaWduSW5Vcmw7XG4gICAgfVxuXG4gICAgLyogU2V0cyBzaWduIG91dCBQT1NUIFVSTCAqL1xuICAgIGlmIChuZy5pc1N0cmluZyhjb25maWcuc2lnbk91dFVybCkpIHtcbiAgICAgIENPTkZJRy5zaWduT3V0VXJsID0gY29uZmlnLnNpZ25PdXRVcmw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIG5nU2Vzc2lvbiBwcm92aWRlciBkZWZpbml0aW9uLlxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgdmFyIG5nU2Vzc2lvblByb3ZpZGVyRGVmID0ge1xuICAgIGNvbmZpZ3VyZTogY29uZmlndXJlLFxuXG4gICAgJGdldDogW1xuICAgICAgJyRyb290U2NvcGUnLCAnJGh0dHAnLCAnJHEnLFxuXG4gICAgICBuZ1Nlc3Npb25TZXJ2aWNlRm5cbiAgICBdXG4gIH07XG5cbiAgLyoqXG4gICAqIG5nU2Vzc2lvbiBwcm92aWRlciBmdW5jdGlvbi5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGZ1bmN0aW9uIG5nU2Vzc2lvblByb3ZpZGVyRm4oKSB7XG4gICAgcmV0dXJuIG5nU2Vzc2lvblByb3ZpZGVyRGVmO1xuICB9XG5cbiAgLyogRGVmaW5lIEFuZ3VsYXJKUyBtb2R1bGUgKi9cbiAgbmcubW9kdWxlKCduZ1Nlc3Npb24nLCBbXSlcblxuICAvKiBEZWZpbmUgc2VydmljZSBwcm92aWRlciAqL1xuICAucHJvdmlkZXIoJ25nU2Vzc2lvbicsIG5nU2Vzc2lvblByb3ZpZGVyRm4pXG5cbiAgLyogRGVmaW5lIEFuZ3VsYXJKUyBtb2R1bGUgcnVuIGZ1bmN0aW9uICovXG4gIC5ydW4oWyckcm91dGUnLCBuZ1Nlc3Npb25SdW5Gbl0pO1xuXG59KHdpbmRvdykpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
